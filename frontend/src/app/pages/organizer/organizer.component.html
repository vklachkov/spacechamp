<nz-layout class="nz-layout">
    <nz-header class="nz-header">
        <app-header>
            <form header-left class="filter" [formGroup]="filterForm">
                <nz-input-group [nzSuffix]="suffixIconSearch">
                    <input nz-input type="text" placeholder="Поиск участника" formControlName="search" />
                </nz-input-group>
    
                <ng-template #suffixIconSearch>
                    <span nz-icon nzType="search"></span>
                </ng-template>
        
                <button 
                    class="filter__show-options"
                    nz-button
                    nz-popover
                    nzPopoverTrigger="click"
                    nzPopoverPlacement="bottom"
                    [nzPopoverContent]="contentTemplate"
                    [nzPopoverOverlayStyle]="{'width': '34em'}"
                    [(nzPopoverVisible)]="filterVisible"
                    (nzPopoverVisibleChange)="changeFilterVisible($event)"
                >
                    <span nz-icon nzType="setting" nzTheme="outline"></span>
                </button>
    
                <ng-template #contentTemplate>
                    <div class="filter__options">
                        <div class="filter__options-item">
                            <p nz-typography class="filter__options-item-title">Статус</p>

                            <nz-radio-group class="filter__options-group" formControlName="status">
                                <label nz-radio [nzValue]="null">Все</label>
                                <label nz-radio [nzValue]="ParticipantStatus.NotRated">Без оценок</label>
                                <label nz-radio [nzValue]="ParticipantStatus.PartiallyRated">Частично оценненые</label>
                                <label nz-radio [nzValue]="ParticipantStatus.FullRated">Полностью оценненые</label>
                                <label nz-radio [nzValue]="ParticipantStatus.InTeam">В команде</label>
                            </nz-radio-group>
                        </div>

                        <div class="filter__options-item">
                            <p nz-typography class="filter__options-item-title">Сортировка</p>

                            <nz-radio-group class="filter__options-group" formControlName="sort">
                                <label nz-radio [nzValue]="Sort.Id">Номер</label>
                                <label nz-radio [nzValue]="Sort.Name">Имя</label>
                                <label nz-radio [nzValue]="Sort.City">Город</label>
                                <label nz-radio [nzValue]="Sort.District">Район</label>
                            </nz-radio-group>
                        </div>

                        <div class="filter__options-item">
                            <p nz-typography class="filter__options-item-title">Порядок</p>

                            <nz-radio-group class="filter__options-group" formControlName="order">
                                <label nz-radio [nzValue]="Order.ASC">{{ ascSortLabel }}</label>
                                <label nz-radio [nzValue]="Order.DESC">{{ descSortLabel }}</label>
                            </nz-radio-group>
                        </div>
                    </div>
                </ng-template>
            </form>

            <nz-spin header-left [nzSpinning]="isDownloadingReport">
                <button nz-button nzType="default" (click)="getReport()">
                    <span nz-icon nzType="download" nzTheme="outline"></span>
                    Отчёт
                </button>
            </nz-spin>

            <button nz-button header-right (click)="goToJuryPanel()">
                <span nz-icon nzType="star" nzTheme="outline"></span>
                Аккаунты
            </button>

            <app-logout-button header-right />
        </app-header>
    </nz-header>

    <nz-content class="nz-content">
        <div #scrollElement class="content h-100">
            @if (isParticipantsLoading) {
                <!-- TODO(vklachkov): Wrap cards-container witgh nz-spin and remove if's and style hacks -->
                <nz-spin class="spin spin-height-100"></nz-spin>
            } @else if (virtualizer) {
                <div class="content__cards-container" [style.height.px]="virtualizer.getTotalSize()">
                    @for (row of virtualizer.getVirtualItems(); track row.index) {
                        <app-participant-card
                            [attr.data-index]="row.index"
                            [style.height.px]="row.size"
                            [style.transform]="'translateY(' + row.start + 'px)'"
                            [participant]="participants[row.index]" />
                    }
                </div>
            }
        </div>
    </nz-content>
</nz-layout>
